CREATE TABLE IF NOT EXISTS Serien (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    link VARCHAR(255),
    other_links  VARCHAR(255), 
    watcher BOOLEAN DEFAULT '0' NOT NULL, 
    status varchar(25) CHECK (status IN ('idc','new','process','done','ERROR', '')),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    last_changed TIMESTAMP DEFAULT CURRENT_TIMESTAMP
) 
CREATE TABLE IF NOT EXISTS hoster (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(255),
    priority INT(9) UNIQUE, 
    regex1 VARCHAR(255),
    regex2 VARCHAR(255),
    regex3 VARCHAR(255),
    status varchar(25) NOT NULL CHECK (status IN ('working','test','ERROR')),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    last_changed TIMESTAMP DEFAULT CURRENT_TIMESTAMP
) 

CREATE TABLE IF NOT EXISTS Staffel (
    id INT AUTO_INCREMENT PRIMARY KEY,
    serien_id INT,
    nr VARCHAR(255),
    name VARCHAR(255),
    link  VARCHAR(255), 
    watcher BOOLEAN DEFAULT '0' NOT NULL, 
    status varchar(25) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    last_changed TIMESTAMP DEFAULT CURRENT_TIMESTAMP
) 
-- status varchar(25) NOT NULL CHECK (status IN ('idc','new','process','ERROR')), change id to int
CREATE TABLE IF NOT EXISTS Episode (
    id INT AUTO_INCREMENT PRIMARY KEY,
    season_id VARCHAR(255) NOT NULL,
    nr VARCHAR(255) NOT NULL,
    name VARCHAR(255) NOT NULL,
    pid VARCHAR(255) UNIQUE,
    check_quali BOOLEAN DEFAULT '0' NOT NULL, 
    bs_link  VARCHAR(255), 
    avl_hoster VARCHAR(255), 
    link VARCHAR(255),
    link_quali  VARCHAR(255),
    temp_link  VARCHAR(255),
    temp_link_quali  VARCHAR(255), 
    watcher BOOLEAN DEFAULT '0' NOT NULL, 
    status varchar(25) NOT NULL,
    error_msg varchar(255),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    last_changed TIMESTAMP DEFAULT CURRENT_TIMESTAMP
) 

CREATE TABLE IF NOT EXISTS Movie (
    id INT AUTO_INCREMENT PRIMARY KEY,
    season_id INT NOT NULL,
    nr VARCHAR(255) NOT NULL,
    name VARCHAR(255) NOT NULL,
    stack_able BOOLEAN DEFAULT '0' NOT NULL, 
    check_quali BOOLEAN DEFAULT '0' NOT NULL, 
    link  VARCHAR(255), 
    link_quali  VARCHAR(255),
    temp_link VARCHAR(255),  
    temp_link_quali  VARCHAR(255), 

    watcher BOOLEAN DEFAULT '0' NOT NULL, 
    status varchar(25) NOT NULL CHECK (status IN ('idc','new','process','ERROR')),
    error_msg varchar(255),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    last_changed TIMESTAMP DEFAULT CURRENT_TIMESTAMP
) 
CREATE OR REPLACE VIEW Files AS SELECT
    Serien.id AS serien_id,
    Staffel.id AS staffel_id,
    Episode.id AS episode_id,
     Episode.name AS serien_name,
    Staffel.nr AS staffel_nr,
    Episode.name AS episode_name,
    Episode.nr AS episode_nr,
    CONCAT(   REPLACE(Serien.name, ' ', '.'), "-S", Staffel.nr ,"-E", Episode.nr,"-", REPLACE(Episode.name, ' ', '.'),".mp4") AS filename, 
    Episode.pid,
    Episode.link,
    Episode.link_quali,
    Episode.status
FROM
    Episode
INNER JOIN Staffel ON Episode.season_id = Staffel.id
INNER JOIN Serien ON Staffel.serien_id = Serien.id
WHERE
    Episode.status != "new"
  AND  Episode.status != "idc"